!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.mosaic=e()}(this,function(){"use strict";var t,e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};!function(t){var i=function(){function t(){var n=arguments.length<=0||void 0===arguments[0]?[0,0,0]:arguments[0];e(this,t),this.xyz=n}return n(t,[{key:"toString",value:function(){return this.xyz.join(", ")}},{key:"add",value:function(e){return new t([this.x+e.x,this.y+e.y,this.z+e.z])}},{key:"subtract",value:function(e){return new t([this.x-e.x,this.y-e.y,this.z-e.z])}},{key:"divideScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x/e,n.y=0==this.y?0:this.y/e,n.z=0==this.z?0:this.z/e,n}},{key:"multiplyScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x*e,n.y=0==this.y?0:this.y*e,n.z=0==this.z?0:this.z*e,n}},{key:"multiplyVectors",value:function(e){var n=new t;return n.x=this.x*e.x,n.y=this.y*e.y,n.z=this.z*e.z,n}},{key:"divideVectors",value:function(e){var n=new t;return n.x=this.x/e.x,n.y=this.y/e.y,n.z=this.z/e.z,n}},{key:"cross",value:function(e){var n=new t;return n.x=this.y*e.z-this.z*e.y,n.y=this.z*e.x-this.x*e.z,n.z=this.x*e.y-this.y*e.x,n}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"min",value:function(e){var n=new t;return n.x=this.x<e.x?this.x:e.x,n.y=this.y<e.y?this.y:e.y,n.z=this.z<e.z?this.z:e.z,n}},{key:"max",value:function(e){var n=new t;return n.x=this.x>e.x?this.x:e.x,n.y=this.y>e.y?this.y:e.y,n.z=this.z>e.z?this.z:e.z,n}},{key:"eq",value:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}},{key:"copy",value:function(){var e=new t;return e.x=this.x,e.y=this.y,e.z=this.z,e}},{key:"x",set:function(t){this.xyz[0]=t},get:function(){return this.xyz[0]}},{key:"y",set:function(t){this.xyz[1]=t},get:function(){return this.xyz[1]}},{key:"z",set:function(t){this.xyz[2]=t},get:function(){return this.xyz[2]}}]),t}();t.Three=i}(t||(t={}));var u,s=function(){function i(n){e(this,i),this.rgb=new t.Three(n)}return n(i,[{key:"blend",value:function(e,n,r){var u=new t.Three(this.rgb.xyz);return new i(u.add(e.rgb.multiplyVectors(n.rgb).multiplyScalar(r)).xyz.map(function(t){return Math.ceil(t)}))}},{key:"shade",value:function(t){var e=this.rgb.xyz,n=0>t?0:255,r=0>t?-1*t:t,u=e[0],s=e[1],h=e[2];return new i([Math.round((n-u)*r)+u,Math.round((n-s)*r)+s,Math.round((n-h)*r)+h])}},{key:"toString",value:function(){return"rgb("+this.rgb.toString()+")"}}]),i}();!function(t){var i=1/1048576,r=function(){function t(n){e(this,t);var r,u,s,h,o,a,c,y,l,f,v,x,z=n.length;if(3>z)return void(this.triangles=[]);for(n=n.slice(0),s=new Array(z),r=z;r--;)s[r]=r;for(s.sort(function(t,e){return n[e][0]-n[t][0]}),h=this.sTriangle(n),n.push(h[0],h[1],h[2]),o=[this.cCircle(n,z+0,z+1,z+2)],a=[],c=[],r=s.length;r--;c.length=0){for(x=s[r],u=o.length;u--;)y=n[x][0]-o[u].x,y>0&&y*y>o[u].r?(a.push(o[u]),o.splice(u,1)):(l=n[x][1]-o[u].y,y*y+l*l-o[u].r>i||(c.push(o[u].i,o[u].j,o[u].j,o[u].k,o[u].k,o[u].i),o.splice(u,1)));for(this.deDup(c),u=c.length;u;)v=c[--u],f=c[--u],o.push(this.cCircle(n,f,v,x))}for(r=o.length;r--;)a.push(o[r]);for(o.length=0,r=a.length;r--;)a[r].i<z&&a[r].j<z&&a[r].k<z&&o.push(a[r].i,a[r].j,a[r].k);this.triangles=o}return n(t,[{key:"sTriangle",value:function(t){var e,n,i,r,u,s,h=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<h&&(h=t[e][0]),t[e][0]>a&&(a=t[e][0]),t[e][1]<o&&(o=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=a-h,i=c-o,r=Math.max(n,i),u=h+.5*n,s=o+.5*i,[[u-20*r,s-r],[u,s+20*r],[u+20*r,s-r]]}},{key:"cCircle",value:function(t,e,n,r){var u,s,h,o,a,c,y,l,f,v,x=t[e][0],z=t[e][1],d=t[n][0],p=t[n][1],g=t[r][0],m=t[r][1],k=Math.abs(z-p),w=Math.abs(p-m);if(i>k&&i>w)throw new Error("Points!");return i>k?(o=-((g-d)/(m-p)),c=(d+g)/2,l=(p+m)/2,u=(d+x)/2,s=o*(u-c)+l):i>w?(h=-((d-x)/(p-z)),a=(x+d)/2,y=(z+p)/2,u=(g+d)/2,s=h*(u-a)+y):(h=-((d-x)/(p-z)),o=-((g-d)/(m-p)),a=(x+d)/2,c=(d+g)/2,y=(z+p)/2,l=(p+m)/2,u=(h*a-o*c+l-y)/(h-o),s=k>w?h*(u-a)+y:o*(u-c)+l),f=d-u,v=p-s,{i:e,j:n,k:r,x:u,y:s,r:f*f+v*v}}},{key:"deDup",value:function(t){var e,n,i,r,u,s;for(n=t.length;n;)for(r=t[--n],i=t[--n],e=n;e;)if(s=t[--e],u=t[--e],i===u&&r===s||i===s&&r===u){t.splice(n,2),t.splice(e,2);break}}}]),t}();t.Delaunay=r}(u||(u={}));var h,o=function(){function t(){e(this,t)}return n(t,[{key:"elm",value:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}},{key:"attr",value:function(t,e){return Object.keys(e).forEach(function(n){t.setAttributeNS(null,n,e[n])}),t}}],[{key:"out",value:function(t,e,n){var i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","g");return i.setAttributeNS(null,"viewBox","0 0 "+e+" "+n),i.appendChild(r),t.forEach(function(t){r.appendChild(t)}),i}}]),t}();!function(t){var i=function(){function t(){var n=arguments.length<=0||void 0===arguments[0]?[0,0,0]:arguments[0];e(this,t),this.xyz=n}return n(t,[{key:"toString",value:function(){return this.xyz.join(", ")}},{key:"add",value:function(e){return new t([this.x+e.x,this.y+e.y,this.z+e.z])}},{key:"subtract",value:function(e){return new t([this.x-e.x,this.y-e.y,this.z-e.z])}},{key:"divideScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x/e,n.y=0==this.y?0:this.y/e,n.z=0==this.z?0:this.z/e,n}},{key:"multiplyScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x*e,n.y=0==this.y?0:this.y*e,n.z=0==this.z?0:this.z*e,n}},{key:"multiplyVectors",value:function(e){var n=new t;return n.x=this.x*e.x,n.y=this.y*e.y,n.z=this.z*e.z,n}},{key:"divideVectors",value:function(e){var n=new t;return n.x=this.x/e.x,n.y=this.y/e.y,n.z=this.z/e.z,n}},{key:"cross",value:function(e){var n=new t;return n.x=this.y*e.z-this.z*e.y,n.y=this.z*e.x-this.x*e.z,n.z=this.x*e.y-this.y*e.x,n}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"min",value:function(e){var n=new t;return n.x=this.x<e.x?this.x:e.x,n.y=this.y<e.y?this.y:e.y,n.z=this.z<e.z?this.z:e.z,n}},{key:"max",value:function(e){var n=new t;return n.x=this.x>e.x?this.x:e.x,n.y=this.y>e.y?this.y:e.y,n.z=this.z>e.z?this.z:e.z,n}},{key:"eq",value:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}},{key:"copy",value:function(){var e=new t;return e.x=this.x,e.y=this.y,e.z=this.z,e}},{key:"x",set:function(t){this.xyz[0]=t},get:function(){return this.xyz[0]}},{key:"y",set:function(t){this.xyz[1]=t},get:function(){return this.xyz[1]}},{key:"z",set:function(t){this.xyz[2]=t},get:function(){return this.xyz[2]}}]),t}();t.Three=i}(h||(h={}));var a=function(t){function u(){return e(this,u),r(this,Object.getPrototypeOf(u).apply(this,arguments))}return i(u,t),n(u,[{key:"render",value:function(){var t=this.attr(this.elm("polygon"),{"stroke-linejoin":"round","stroke-miterlimit":"1","stroke-width":"1",points:this.points.map(function(t){return t.x+" "+t.y}).join(" "),style:"fill:"+this.colour.toString()+"; stroke:"+this.colour.toString()+";"});return t}}]),u}(o),c=function(t){function u(t,n){e(this,u);var i=r(this,Object.getPrototypeOf(u).call(this));return i.points=t,i.colour=n,i.face=function(t){return t>50?0:50>t&&t>25?1:25>t?2:void 0}(100*Math.random()),i.el=i.render(),i.centroid=i.calcCentroid(),i.normal=i.calcNormal(),i}return i(u,t),n(u,[{key:"calcCentroid",value:function(){var t=new h.Three([this.points.map(function(t){return t.x}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.y}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.z}).reduce(function(t,e){return t+e})]);return t.divideScalar(3)}},{key:"calcNormal",value:function(){return this.a.subtract(this.b).cross(this.a.subtract(this.c)).normalize()}},{key:"a",get:function(){return this.points[0]}},{key:"b",get:function(){return this.points[1]}},{key:"c",get:function(){return this.points[2]}}]),u}(a);Array.prototype.chunk=function(t){var e=this;return Array.apply(null,Array(Math.ceil(this.length/t))).map(function(t,e){return e}).map(function(n,i){return e.slice(i*t,i*t+t)})};var y=function(){function t(n,i,r,u){var h=this;e(this,t),this.el=n,this.count=u;var a=function(){h.clear(),h.mesh=new f(h.el.offsetWidth,h.el.offsetHeight,h.count,new s(r),new s(i)),n.appendChild(o.out(h.mesh.polygons.map(function(t){return t.el}),h.el.offsetWidth,h.el.offsetHeight))};a();var c=0,y=function l(){h.mesh.blendNow()&&h.mesh.blendLights(),(0==c||c!=h.el.offsetWidth+h.el.offsetHeight)&&(c=h.el.offsetWidth+h.el.offsetHeight,a(),h.mesh.blendLights()),requestAnimationFrame(l)};y()}return n(t,[{key:"clear",value:function(){for(var t=this.el.childNodes.length-1;t>=0;t--)this.el.removeChild(this.el.childNodes[t])}}]),t}(),l=function(){function t(n){var i=this;e(this,t),this.ray=n,this.ray=n,self.addEventListener("mousemove",function(t){i.ray.x=t.pageX,i.ray.y=t.pageY})}return n(t,[{key:"blendLights",value:function(){for(var t=0;t<this.polygons.length;t++){var e=this.polygons[t],n=function(t){switch(e.face){case 1:return.99*Math.abs(Math.min(t,0));case 2:return.89*Math.max(Math.abs(t),0);default:return.85*Math.abs(t)}}(e.normal.dot(this.ray.subtract(e.centroid).normalize())),i=e.colour.blend(this.ambient,this.diffuse,n);e.el.setAttributeNS(null,"style","fill: "+i.toString()+"; stroke: "+i.toString()+";")}}}]),t}(),f=function(s){function h(n,i,s,o,a){e(this,h);var y=r(this,Object.getPrototypeOf(h).call(this,new t.Three([n/2,i/2,1.2])));y.width=n,y.height=i,y.slices=s,y.ambient=o,y.diffuse=a;var l,f,v=0,x=y.height;for(f=new Array(s),l=s;l>=0;l--)f[l]=[v+Math.random()*n,x-Math.random()*i];for(f.push([v,x]),f.push([v+n/2,x]),f.push([v+n,x]),f.push([v+n,x-i/2]),f.push([v+n,x-i]),f.push([v+n/2,x-i]),f.push([v,x-i]),f.push([v,x-i/2]),l=6;l>=0;l--)f.push([v+Math.random()*n,x]),f.push([v,x-Math.random()*i]),f.push([v+n,x-Math.random()*i]),f.push([v+Math.random()*n,x-i]);return y.polygons=new u.Delaunay(f).triangles.chunk(3).map(function(e){var n=new Array(e.length);return n=e.map(function(e){var n=new t.Three([f[e][0],f[e][1],0]);return n}),new c(n,o)}),y}return i(h,s),n(h,[{key:"blendNow",value:function(){return this.mouseXY!=this.ray.x+this.ray.y?(this.mouseXY=this.ray.x+this.ray.y,!0):!1}}]),h}(l);return y});