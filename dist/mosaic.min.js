var _Mathabs=Math.abs,_Mathmax=Math.max,_NumberNEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,_NumberPOSITIVE_INFINITY=Number.POSITIVE_INFINITY,_Mathround=Math.round,_Mathceil=Math.ceil,_Mathsqrt=Math.sqrt;!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.mosaic=e()}(this,function(){"use strict";var t,e=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},n=function(){function t(t,e){for(var n,r=0;r<e.length;r++)n=e[r],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),r=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};!function(t){var r=function(){function t(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[0,0,0];e(this,t),this.xyz=n}return n(t,[{key:"toString",value:function(){return this.xyz.join(", ")}},{key:"add",value:function(e){return new t([this.x+e.x,this.y+e.y,this.z+e.z])}},{key:"subtract",value:function(e){return new t([this.x-e.x,this.y-e.y,this.z-e.z])}},{key:"divideScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x/e,n.y=0==this.y?0:this.y/e,n.z=0==this.z?0:this.z/e,n}},{key:"multiplyScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x*e,n.y=0==this.y?0:this.y*e,n.z=0==this.z?0:this.z*e,n}},{key:"multiplyVectors",value:function(e){var n=new t;return n.x=this.x*e.x,n.y=this.y*e.y,n.z=this.z*e.z,n}},{key:"divideVectors",value:function(e){var n=new t;return n.x=this.x/e.x,n.y=this.y/e.y,n.z=this.z/e.z,n}},{key:"cross",value:function(e){var n=new t;return n.x=this.y*e.z-this.z*e.y,n.y=this.z*e.x-this.x*e.z,n.z=this.x*e.y-this.y*e.x,n}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return _Mathsqrt(this.lengthSquared())}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}},{key:"distance",value:function(t){return _Mathsqrt(this.distanceSquared(t))}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"min",value:function(e){var n=new t;return n.x=this.x<e.x?this.x:e.x,n.y=this.y<e.y?this.y:e.y,n.z=this.z<e.z?this.z:e.z,n}},{key:"max",value:function(e){var n=new t;return n.x=this.x>e.x?this.x:e.x,n.y=this.y>e.y?this.y:e.y,n.z=this.z>e.z?this.z:e.z,n}},{key:"eq",value:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}},{key:"copy",value:function(){var e=new t;return e.x=this.x,e.y=this.y,e.z=this.z,e}},{key:"x",set:function(t){this.xyz[0]=t},get:function(){return this.xyz[0]}},{key:"y",set:function(t){this.xyz[1]=t},get:function(){return this.xyz[1]}},{key:"z",set:function(t){this.xyz[2]=t},get:function(){return this.xyz[2]}}]),t}();t.Three=r}(t||(t={}));var u,o=function(){function r(n){e(this,r),this.rgb=new t.Three(n)}return n(r,[{key:"blend",value:function(e,n,i){var u=new t.Three(this.rgb.xyz);return new r(u.add(e.rgb.multiplyVectors(n.rgb).multiplyScalar(i)).xyz.map(function(t){return _Mathceil(t)}))}},{key:"shade",value:function(t){var e=this.rgb.xyz,n=0>t?0:255,i=0>t?-1*t:t,u=e[0],o=e[1],s=e[2];return new r([_Mathround((n-u)*i)+u,_Mathround((n-o)*i)+o,_Mathround((n-s)*i)+s])}},{key:"toString",value:function(){return"rgb("+this.rgb.toString()+")"}}]),r}();!function(t){var r=1/1048576,i=function(){function t(n){e(this,t);var i,u,o,s,h,a,c,l,f,y,p,d,v=n.length;if(3>v)return void(this.triangles=[]);for(n=n.slice(0),o=Array(v),i=v;i--;)o[i]=i;for(o.sort(function(t,e){return n[e][0]-n[t][0]}),s=this.sTriangle(n),n.push(s[0],s[1],s[2]),h=[this.cCircle(n,v+0,v+1,v+2)],a=[],c=[],i=o.length;i--;c.length=0){for(d=o[i],u=h.length;u--;)l=n[d][0]-h[u].x,l>0&&l*l>h[u].r?(a.push(h[u]),h.splice(u,1)):(f=n[d][1]-h[u].y,!(l*l+f*f-h[u].r>r)&&(c.push(h[u].i,h[u].j,h[u].j,h[u].k,h[u].k,h[u].i),h.splice(u,1)));for(this.deDup(c),u=c.length;u;)p=c[--u],y=c[--u],h.push(this.cCircle(n,y,p,d))}for(i=h.length;i--;)a.push(h[i]);for(h.length=0,i=a.length;i--;)a[i].i<v&&a[i].j<v&&a[i].k<v&&h.push(a[i].i,a[i].j,a[i].k);this.triangles=h}return n(t,[{key:"sTriangle",value:function(t){var e,n,r,i,u,o,s=_NumberPOSITIVE_INFINITY,h=_NumberPOSITIVE_INFINITY,a=_NumberNEGATIVE_INFINITY,c=_NumberNEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<s&&(s=t[e][0]),t[e][0]>a&&(a=t[e][0]),t[e][1]<h&&(h=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=a-s,r=c-h,i=_Mathmax(n,r),u=s+.5*n,o=h+.5*r,[[u-20*i,o-i],[u,o+20*i],[u+20*i,o-i]]}},{key:"cCircle",value:function(t,e,n,i){var u,o,s,h,a,c,l,f,y,p,d=t[e][0],v=t[e][1],m=t[n][0],g=t[n][1],x=t[i][0],b=t[i][1],z=_Mathabs(v-g),k=_Mathabs(g-b);if(r>z&&r>k)throw new Error("Points!");return r>z?(h=-((x-m)/(b-g)),c=(m+x)/2,f=(g+b)/2,u=(m+d)/2,o=h*(u-c)+f):r>k?(s=-((m-d)/(g-v)),a=(d+m)/2,l=(v+g)/2,u=(x+m)/2,o=s*(u-a)+l):(s=-((m-d)/(g-v)),h=-((x-m)/(b-g)),a=(d+m)/2,c=(m+x)/2,l=(v+g)/2,f=(g+b)/2,u=(s*a-h*c+f-l)/(s-h),o=z>k?s*(u-a)+l:h*(u-c)+f),y=m-u,p=g-o,{i:e,j:n,k:i,x:u,y:o,r:y*y+p*p}}},{key:"deDup",value:function(t){var e,n,r,i,u,o;for(n=t.length;n;)for(i=t[--n],r=t[--n],e=n;e;)if(o=t[--e],u=t[--e],r===u&&i===o||r===o&&i===u){t.splice(n,2),t.splice(e,2);break}}}]),t}();t.Delaunay=i}(u||(u={}));var s=function(){function t(){e(this,t)}return n(t,[{key:"elm",value:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}},{key:"attr",value:function(t,e){return Object.keys(e).forEach(function(n){t.setAttributeNS(null,n,e[n])}),t}}],[{key:"out",value:function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","g");return r.setAttributeNS(null,"viewBox","0 0 "+e+" "+n),r.appendChild(i),t.forEach(function(t){i.appendChild(t)}),r}}]),t}(),h=function(t){function u(){return e(this,u),i(this,(u.__proto__||Object.getPrototypeOf(u)).apply(this,arguments))}return r(u,t),n(u,[{key:"render",value:function(){var t=this.attr(this.elm("polygon"),{"stroke-linejoin":"round","stroke-miterlimit":"1","stroke-width":"1",points:this.points.map(function(t){return t.x+" "+t.y}).join(" "),style:"fill:"+this.colour.toString()+"; stroke:"+this.colour.toString()+";"});return t}}]),u}(s),a=function(u){function o(t,n){e(this,o);var r=i(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));return r.points=t,r.colour=n,r.face=function(t){return t>50?0:50>t&&t>25?1:25>t?2:void 0}(100*Math.random()),r.el=r.render(),r.centroid=r.calcCentroid(),r.normal=r.calcNormal(),r}return r(o,u),n(o,[{key:"calcCentroid",value:function(){var e=new t.Three([this.points.map(function(t){return t.x}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.y}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.z}).reduce(function(t,e){return t+e})]);return e.divideScalar(3)}},{key:"calcNormal",value:function(){return this.a.subtract(this.b).cross(this.a.subtract(this.c)).normalize()}},{key:"a",get:function(){return this.points[0]}},{key:"b",get:function(){return this.points[1]}},{key:"c",get:function(){return this.points[2]}}]),o}(h);Array.prototype.chunk=function(t){var e=this;return Array.apply(null,Array(_Mathceil(this.length/t))).map(function(t,e){return e}).map(function(n,r){return e.slice(r*t,r*t+t)})};var c=function(){function t(n,r,i,u){var h=this;e(this,t),this.el=n,this.count=u;var a=function(){h.clear(),h.mesh=new f(h.el.offsetWidth,h.el.offsetHeight,h.count,new o(i),new o(r)),n.appendChild(s.out(h.mesh.polygons.map(function(t){return t.el}),h.el.offsetWidth,h.el.offsetHeight))};a();var c=0;!function l(){h.mesh.blendNow()&&h.mesh.blendLights(),(0==c||c!=h.el.offsetWidth+h.el.offsetHeight)&&(c=h.el.offsetWidth+h.el.offsetHeight,a(),h.mesh.blendLights()),requestAnimationFrame(l)}()}return n(t,[{key:"clear",value:function(){for(var t=this.el.childNodes.length-1;t>=0;t--)this.el.removeChild(this.el.childNodes[t])}}]),t}(),l=function(){function t(n){var r=this;e(this,t),this.ray=n,this.ray=n,self.addEventListener("mousemove",function(t){r.ray.x=t.pageX,r.ray.y=t.pageY})}return n(t,[{key:"blendLights",value:function(){for(var t=0;t<this.polygons.length;t++){var e=this.polygons[t],n=function(t){switch(e.face){case 1:return.99*_Mathabs(Math.min(t,0));case 2:return.89*_Mathmax(_Mathabs(t),0);default:return.85*_Mathabs(t)}}(e.normal.dot(this.ray.subtract(e.centroid).normalize())),r=e.colour.blend(this.ambient,this.diffuse,n);e.el.setAttributeNS(null,"style","fill: "+r.toString()+"; stroke: "+r.toString()+";")}}}]),t}(),f=function(o){function s(n,r,o,h,c){e(this,s);var l=i(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,new t.Three([n/2,r/2,1.2])));l.width=n,l.height=r,l.slices=o,l.ambient=h,l.diffuse=c;var f,y,p=0,d=l.height;for(y=Array(o),f=o;f>=0;f--)y[f]=[p+Math.random()*n,d-Math.random()*r];for(y.push([p,d]),y.push([p+n/2,d]),y.push([p+n,d]),y.push([p+n,d-r/2]),y.push([p+n,d-r]),y.push([p+n/2,d-r]),y.push([p,d-r]),y.push([p,d-r/2]),f=6;f>=0;f--)y.push([p+Math.random()*n,d]),y.push([p,d-Math.random()*r]),y.push([p+n,d-Math.random()*r]),y.push([p+Math.random()*n,d-r]);return l.polygons=new u.Delaunay(y).triangles.chunk(3).map(function(e){var n=Array(e.length);return n=e.map(function(e){var n=new t.Three([y[e][0],y[e][1],0]);return n}),new a(n,h)}),l}return r(s,o),n(s,[{key:"blendNow",value:function(){return this.mouseXY!=this.ray.x+this.ray.y&&(this.mouseXY=this.ray.x+this.ray.y,!0)}}]),s}(l);return c});