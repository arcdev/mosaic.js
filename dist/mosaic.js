!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("mosaic",["exports"],e):e(t.Mosaic=t.Mosaic||{})}(this,function(t){"use strict";var e={};e.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e.createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),e.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},e.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var n;!function(t){var n=1/1048576,r=function(){function t(r){e.classCallCheck(this,t);var i,s,u,a,o,h,c,l,f,y,p,d,v=r.length;if(3>v)return void(this.triangles=[]);for(r=r.slice(0),u=new Array(v),i=v;i--;)u[i]=i;for(u.sort(function(t,e){return r[e][0]-r[t][0]}),a=this.sTriangle(r),r.push(a[0],a[1],a[2]),o=[this.cCircle(r,v+0,v+1,v+2)],h=[],c=[],i=u.length;i--;c.length=0){for(d=u[i],s=o.length;s--;)l=r[d][0]-o[s].x,l>0&&l*l>o[s].r?(h.push(o[s]),o.splice(s,1)):(f=r[d][1]-o[s].y,l*l+f*f-o[s].r>n||(c.push(o[s].i,o[s].j,o[s].j,o[s].k,o[s].k,o[s].i),o.splice(s,1)));for(this.deDup(c),s=c.length;s;)p=c[--s],y=c[--s],o.push(this.cCircle(r,y,p,d))}for(i=o.length;i--;)h.push(o[i]);for(o.length=0,i=h.length;i--;)h[i].i<v&&h[i].j<v&&h[i].k<v&&o.push(h[i].i,h[i].j,h[i].k);this.triangles=o}return e.createClass(t,[{key:"sTriangle",value:function(t){var e,n,r,i,s,u,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<a&&(a=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<o&&(o=t[e][1]),t[e][1]>c&&(c=t[e][1]);return n=h-a,r=c-o,i=Math.max(n,r),s=a+.5*n,u=o+.5*r,[[s-20*i,u-i],[s,u+20*i],[s+20*i,u-i]]}},{key:"cCircle",value:function(t,e,r,i){var s,u,a,o,h,c,l,f,y,p,d=t[e][0],v=t[e][1],g=t[r][0],m=t[r][1],x=t[i][0],k=t[i][1],b=Math.abs(v-m),z=Math.abs(m-k);if(n>b&&n>z)throw new Error("Points!");return n>b?(o=-((x-g)/(k-m)),c=(g+x)/2,f=(m+k)/2,s=(g+d)/2,u=o*(s-c)+f):n>z?(a=-((g-d)/(m-v)),h=(d+g)/2,l=(v+m)/2,s=(x+g)/2,u=a*(s-h)+l):(a=-((g-d)/(m-v)),o=-((x-g)/(k-m)),h=(d+g)/2,c=(g+x)/2,l=(v+m)/2,f=(m+k)/2,s=(a*h-o*c+f-l)/(a-o),u=b>z?a*(s-h)+l:o*(s-c)+f),y=g-s,p=m-u,{i:e,j:r,k:i,x:s,y:u,r:y*y+p*p}}},{key:"deDup",value:function(t){var e,n,r,i,s,u;for(n=t.length;n;)for(i=t[--n],r=t[--n],e=n;e;)if(u=t[--e],s=t[--e],r===s&&i===u||r===u&&i===s){t.splice(n,2),t.splice(e,2);break}}}]),t}();t.Delaunay=r}(n||(n={}));var r;!function(t){var n=function(){function t(){var n=arguments.length<=0||void 0===arguments[0]?[0,0,0]:arguments[0];e.classCallCheck(this,t),this.xyz=n}return e.createClass(t,[{key:"toString",value:function(){return this.xyz.join(", ")}},{key:"add",value:function(e){return new t([this.x+e.x,this.y+e.y,this.z+e.z])}},{key:"subtract",value:function(e){return new t([this.x-e.x,this.y-e.y,this.z-e.z])}},{key:"divideScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x/e,n.y=0==this.y?0:this.y/e,n.z=0==this.z?0:this.z/e,n}},{key:"multiplyScalar",value:function(e){var n=new t;return n.x=0==this.x?0:this.x*e,n.y=0==this.y?0:this.y*e,n.z=0==this.z?0:this.z*e,n}},{key:"multiplyVectors",value:function(e){var n=new t;return n.x=this.x*e.x,n.y=this.y*e.y,n.z=this.z*e.z,n}},{key:"divideVectors",value:function(e){var n=new t;return n.x=this.x/e.x,n.y=this.y/e.y,n.z=this.z/e.z,n}},{key:"cross",value:function(e){var n=new t;return n.x=this.y*e.z-this.z*e.y,n.y=this.z*e.x-this.x*e.z,n.z=this.x*e.y-this.y*e.x,n}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"min",value:function(e){var n=new t;return n.x=this.x<e.x?this.x:e.x,n.y=this.y<e.y?this.y:e.y,n.z=this.z<e.z?this.z:e.z,n}},{key:"max",value:function(e){var n=new t;return n.x=this.x>e.x?this.x:e.x,n.y=this.y>e.y?this.y:e.y,n.z=this.z>e.z?this.z:e.z,n}},{key:"eq",value:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}},{key:"copy",value:function(){var e=new t;return e.x=this.x,e.y=this.y,e.z=this.z,e}},{key:"x",set:function(t){this.xyz[0]=t},get:function(){return this.xyz[0]}},{key:"y",set:function(t){this.xyz[1]=t},get:function(){return this.xyz[1]}},{key:"z",set:function(t){this.xyz[2]=t},get:function(){return this.xyz[2]}}]),t}();t.Three=n}(r||(r={})),Array.prototype.chunk=function(t){var e=this;return Array.apply(null,Array(Math.ceil(this.length/t))).map(function(t,e){return e}).map(function(n,r){return e.slice(r*t,r*t+t)})},t.Vandal,function(t){var i=function(){function t(n,r,i,u){var h=this;e.classCallCheck(this,t),this.el=n,this.count=u;var c=function(){h.clear(),h.mesh=new a(h.el.offsetWidth,h.el.offsetHeight,h.count,new s(i),new s(r)),n.appendChild(o.out(h.mesh.polygons.map(function(t){return t.el}),h.el.offsetWidth,h.el.offsetHeight))};c();var l=0,f=function y(){h.mesh.blendNow()&&h.mesh.blendLights(),(0==l||l!=h.el.offsetWidth+h.el.offsetHeight)&&(l=h.el.offsetWidth+h.el.offsetHeight,c(),h.mesh.blendLights()),requestAnimationFrame(y)};requestAnimationFrame(f)}return e.createClass(t,[{key:"clear",value:function(){for(var t=this.el.childNodes.length-1;t>=0;t--)this.el.removeChild(this.el.childNodes[t])}}]),t}();t.Mosaic=i;var s=function(){function t(n){e.classCallCheck(this,t),this.rgb=new r.Three(n)}return e.createClass(t,[{key:"blend",value:function(e,n,i){var s=new r.Three(this.rgb.xyz);return new t(s.add(e.rgb.multiplyVectors(n.rgb).multiplyScalar(i)).xyz.map(function(t){return Math.ceil(t)}))}},{key:"shade",value:function(e){var n=this.rgb.xyz,r=0>e?0:255,i=0>e?-1*e:e,s=n[0],u=n[1],a=n[2];return new t([Math.round((r-s)*i)+s,Math.round((r-u)*i)+u,Math.round((r-a)*i)+a])}},{key:"toString",value:function(){return"rgb("+this.rgb.toString()+")"}}]),t}(),u=function(){function t(){var n=this;e.classCallCheck(this,t),this.ray=new r.Three([this.width/2,this.height/2,1.2]),self.addEventListener("mousemove",function(t){n.ray.x=t.pageX,n.ray.y=t.pageY})}return e.createClass(t,[{key:"blendLights",value:function(){for(var t=0;t<this.polygons.length;t++){var e=this.polygons[t],n=function(t){switch(e.face){case 1:return.99*Math.abs(Math.min(t,0));case 2:return.89*Math.max(Math.abs(t),0);default:return.85*Math.abs(t)}}(e.normal.dot(this.ray.subtract(e.centroid).normalize())),r=e.colour.blend(this.ambient,this.diffuse,n);e.el.setAttributeNS(null,"style","fill: "+r.toString()+"; stroke: "+r.toString()+";")}}}]),t}(),a=function(t){function i(t,s,u,a,o){e.classCallCheck(this,i);var h=e.possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this));h.width=t,h.height=s,h.slices=u,h.ambient=a,h.diffuse=o;var l,f,y=0,p=h.height;for(f=new Array(u),l=u;l>=0;l--)f[l]=[y+Math.random()*t,p-Math.random()*s];for(f.push([y,p]),f.push([y+t/2,p]),f.push([y+t,p]),f.push([y+t,p-s/2]),f.push([y+t,p-s]),f.push([y+t/2,p-s]),f.push([y,p-s]),f.push([y,p-s/2]),l=6;l>=0;l--)f.push([y+Math.random()*t,p]),f.push([y,p-Math.random()*s]),f.push([y+t,p-Math.random()*s]),f.push([y+Math.random()*t,p-s]);return h.polygons=new n.Delaunay(f).triangles.chunk(3).map(function(t){var e=new Array(t.length);return e=t.map(function(t){var e=new r.Three([f[t][0],f[t][1],0]);return e}),new c(e,a)}),h}return e.inherits(i,t),e.createClass(i,[{key:"blendNow",value:function(){return this.mouseXY!=this.ray.x+this.ray.y?(this.mouseXY=this.ray.x+this.ray.y,!0):!1}}]),i}(u),o=function(){function t(){e.classCallCheck(this,t)}return e.createClass(t,[{key:"elm",value:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}},{key:"attr",value:function(t,e){return Object.keys(e).forEach(function(n){t.setAttributeNS(null,n,e[n])}),t}}],[{key:"out",value:function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","g");return r.setAttributeNS(null,"viewBox","0 0 "+e+" "+n),r.appendChild(i),t.forEach(function(t){i.appendChild(t)}),r}}]),t}(),h=function(t){function n(){return e.classCallCheck(this,n),e.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return e.inherits(n,t),e.createClass(n,[{key:"render",value:function(){var t=this.attr(this.elm("polygon"),{"stroke-linejoin":"round","stroke-miterlimit":"1","stroke-width":"1",points:this.points.map(function(t){return t.x+" "+t.y}).join(" "),style:"fill:"+this.colour.toString()+"; stroke:"+this.colour.toString()+";"});return t}}]),n}(o),c=function(t){function n(t,r){e.classCallCheck(this,n);var i=e.possibleConstructorReturn(this,Object.getPrototypeOf(n).call(this));return i.points=t,i.colour=r,i.face=function(t){return t>50?0:50>t&&t>25?1:25>t?2:void 0}(100*Math.random()),i.el=i.render(),i.centroid=i.calcCentroid(),i.normal=i.calcNormal(),i}return e.inherits(n,t),e.createClass(n,[{key:"calcCentroid",value:function(){var t=new r.Three([this.points.map(function(t){return t.x}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.y}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.z}).reduce(function(t,e){return t+e})]);return t.divideScalar(3)}},{key:"calcNormal",value:function(){return this.a.subtract(this.b).cross(this.a.subtract(this.c)).normalize()}},{key:"a",get:function(){return this.points[0]}},{key:"b",get:function(){return this.points[1]}},{key:"c",get:function(){return this.points[2]}}]),n}(h)}(t.Vandal||(t.Vandal={}))});