!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.mosaic=e()}(this,function(){"use strict";var t={};t.classCallCheck=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),t.inherits=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},t.possibleConstructorReturn=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e};var e;!function(e){var n=1/1048576,r=function(){function e(r){t.classCallCheck(this,e);var i,s,u,o,a,h,l,c,f,y,p,d,v=r.length;if(3>v)return void(this.triangles=[]);for(r=r.slice(0),u=new Array(v),i=v;i--;)u[i]=i;for(u.sort(function(t,e){return r[e][0]-r[t][0]}),o=this.sTriangle(r),r.push(o[0],o[1],o[2]),a=[this.cCircle(r,v+0,v+1,v+2)],h=[],l=[],i=u.length;i--;l.length=0){for(d=u[i],s=a.length;s--;)c=r[d][0]-a[s].x,c>0&&c*c>a[s].r?(h.push(a[s]),a.splice(s,1)):(f=r[d][1]-a[s].y,c*c+f*f-a[s].r>n||(l.push(a[s].i,a[s].j,a[s].j,a[s].k,a[s].k,a[s].i),a.splice(s,1)));for(this.deDup(l),s=l.length;s;)p=l[--s],y=l[--s],a.push(this.cCircle(r,y,p,d))}for(i=a.length;i--;)h.push(a[i]);for(a.length=0,i=h.length;i--;)h[i].i<v&&h[i].j<v&&h[i].k<v&&a.push(h[i].i,h[i].j,h[i].k);this.triangles=a}return t.createClass(e,[{key:"sTriangle",value:function(t){var e,n,r,i,s,u,o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(e=t.length;e--;)t[e][0]<o&&(o=t[e][0]),t[e][0]>h&&(h=t[e][0]),t[e][1]<a&&(a=t[e][1]),t[e][1]>l&&(l=t[e][1]);return n=h-o,r=l-a,i=Math.max(n,r),s=o+.5*n,u=a+.5*r,[[s-20*i,u-i],[s,u+20*i],[s+20*i,u-i]]}},{key:"cCircle",value:function(t,e,r,i){var s,u,o,a,h,l,c,f,y,p,d=t[e][0],v=t[e][1],g=t[r][0],m=t[r][1],x=t[i][0],k=t[i][1],b=Math.abs(v-m),z=Math.abs(m-k);if(n>b&&n>z)throw new Error("Points!");return n>b?(a=-((x-g)/(k-m)),l=(g+x)/2,f=(m+k)/2,s=(g+d)/2,u=a*(s-l)+f):n>z?(o=-((g-d)/(m-v)),h=(d+g)/2,c=(v+m)/2,s=(x+g)/2,u=o*(s-h)+c):(o=-((g-d)/(m-v)),a=-((x-g)/(k-m)),h=(d+g)/2,l=(g+x)/2,c=(v+m)/2,f=(m+k)/2,s=(o*h-a*l+f-c)/(o-a),u=b>z?o*(s-h)+c:a*(s-l)+f),y=g-s,p=m-u,{i:e,j:r,k:i,x:s,y:u,r:y*y+p*p}}},{key:"deDup",value:function(t){var e,n,r,i,s,u;for(n=t.length;n;)for(i=t[--n],r=t[--n],e=n;e;)if(u=t[--e],s=t[--e],r===s&&i===u||r===u&&i===s){t.splice(n,2),t.splice(e,2);break}}}]),e}();e.Delaunay=r}(e||(e={}));var n;!function(e){var n=function(){function e(){var n=arguments.length<=0||void 0===arguments[0]?[0,0,0]:arguments[0];t.classCallCheck(this,e),this.xyz=n}return t.createClass(e,[{key:"toString",value:function(){return this.xyz.join(", ")}},{key:"add",value:function(t){return new e([this.x+t.x,this.y+t.y,this.z+t.z])}},{key:"subtract",value:function(t){return new e([this.x-t.x,this.y-t.y,this.z-t.z])}},{key:"divideScalar",value:function(t){var n=new e;return n.x=0==this.x?0:this.x/t,n.y=0==this.y?0:this.y/t,n.z=0==this.z?0:this.z/t,n}},{key:"multiplyScalar",value:function(t){var n=new e;return n.x=0==this.x?0:this.x*t,n.y=0==this.y?0:this.y*t,n.z=0==this.z?0:this.z*t,n}},{key:"multiplyVectors",value:function(t){var n=new e;return n.x=this.x*t.x,n.y=this.y*t.y,n.z=this.z*t.z,n}},{key:"divideVectors",value:function(t){var n=new e;return n.x=this.x/t.x,n.y=this.y/t.y,n.z=this.z/t.z,n}},{key:"cross",value:function(t){var n=new e;return n.x=this.y*t.z-this.z*t.y,n.y=this.z*t.x-this.x*t.z,n.z=this.x*t.y-this.y*t.x,n}},{key:"lengthSquared",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"distanceSquared",value:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"min",value:function(t){var n=new e;return n.x=this.x<t.x?this.x:t.x,n.y=this.y<t.y?this.y:t.y,n.z=this.z<t.z?this.z:t.z,n}},{key:"max",value:function(t){var n=new e;return n.x=this.x>t.x?this.x:t.x,n.y=this.y>t.y?this.y:t.y,n.z=this.z>t.z?this.z:t.z,n}},{key:"eq",value:function(t){return this.x==t.x&&this.y==t.y&&this.z==t.z}},{key:"copy",value:function(){var t=new e;return t.x=this.x,t.y=this.y,t.z=this.z,t}},{key:"x",set:function(t){this.xyz[0]=t},get:function(){return this.xyz[0]}},{key:"y",set:function(t){this.xyz[1]=t},get:function(){return this.xyz[1]}},{key:"z",set:function(t){this.xyz[2]=t},get:function(){return this.xyz[2]}}]),e}();e.Three=n}(n||(n={})),Array.prototype.chunk=function(t){var e=this;return Array.apply(null,Array(Math.ceil(this.length/t))).map(function(t,e){return e}).map(function(n,r){return e.slice(r*t,r*t+t)})};var r=function(){function e(n,r,s,a){var h=this;t.classCallCheck(this,e),this.el=n,this.count=a;var l=function(){h.clear(),h.mesh=new u(h.el.offsetWidth,h.el.offsetHeight,h.count,new i(s),new i(r)),n.appendChild(o.out(h.mesh.polygons.map(function(t){return t.el}),h.el.offsetWidth,h.el.offsetHeight))};l();var c=0,f=function y(){h.mesh.blendNow()&&h.mesh.blendLights(),(0==c||c!=h.el.offsetWidth+h.el.offsetHeight)&&(c=h.el.offsetWidth+h.el.offsetHeight,l(),h.mesh.blendLights()),requestAnimationFrame(y)};requestAnimationFrame(f)}return t.createClass(e,[{key:"clear",value:function(){for(var t=this.el.childNodes.length-1;t>=0;t--)this.el.removeChild(this.el.childNodes[t])}}]),e}(),i=function(){function e(r){t.classCallCheck(this,e),this.rgb=new n.Three(r)}return t.createClass(e,[{key:"blend",value:function(t,r,i){var s=new n.Three(this.rgb.xyz);return new e(s.add(t.rgb.multiplyVectors(r.rgb).multiplyScalar(i)).xyz.map(function(t){return Math.ceil(t)}))}},{key:"shade",value:function(t){var n=this.rgb.xyz,r=0>t?0:255,i=0>t?-1*t:t,s=n[0],u=n[1],o=n[2];return new e([Math.round((r-s)*i)+s,Math.round((r-u)*i)+u,Math.round((r-o)*i)+o])}},{key:"toString",value:function(){return"rgb("+this.rgb.toString()+")"}}]),e}(),s=function(){function e(){var r=this;t.classCallCheck(this,e),this.ray=new n.Three([this.width/2,this.height/2,1.2]),self.addEventListener("mousemove",function(t){r.ray.x=t.pageX,r.ray.y=t.pageY})}return t.createClass(e,[{key:"blendLights",value:function(){for(var t=0;t<this.polygons.length;t++){var e=this.polygons[t],n=function(t){switch(e.face){case 1:return.99*Math.abs(Math.min(t,0));case 2:return.89*Math.max(Math.abs(t),0);default:return.85*Math.abs(t)}}(e.normal.dot(this.ray.subtract(e.centroid).normalize())),r=e.colour.blend(this.ambient,this.diffuse,n);e.el.setAttributeNS(null,"style","fill: "+r.toString()+"; stroke: "+r.toString()+";")}}}]),e}(),u=function(r){function i(r,s,u,o,a){t.classCallCheck(this,i);var l=t.possibleConstructorReturn(this,Object.getPrototypeOf(i).call(this));l.width=r,l.height=s,l.slices=u,l.ambient=o,l.diffuse=a;var c,f,y=0,p=l.height;for(f=new Array(u),c=u;c>=0;c--)f[c]=[y+Math.random()*r,p-Math.random()*s];for(f.push([y,p]),f.push([y+r/2,p]),f.push([y+r,p]),f.push([y+r,p-s/2]),f.push([y+r,p-s]),f.push([y+r/2,p-s]),f.push([y,p-s]),f.push([y,p-s/2]),c=6;c>=0;c--)f.push([y+Math.random()*r,p]),f.push([y,p-Math.random()*s]),f.push([y+r,p-Math.random()*s]),f.push([y+Math.random()*r,p-s]);return l.polygons=new e.Delaunay(f).triangles.chunk(3).map(function(t){var e=new Array(t.length);return e=t.map(function(t){var e=new n.Three([f[t][0],f[t][1],0]);return e}),new h(e,o)}),l}return t.inherits(i,r),t.createClass(i,[{key:"blendNow",value:function(){return this.mouseXY!=this.ray.x+this.ray.y?(this.mouseXY=this.ray.x+this.ray.y,!0):!1}}]),i}(s),o=function(){function e(){t.classCallCheck(this,e)}return t.createClass(e,[{key:"elm",value:function(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}},{key:"attr",value:function(t,e){return Object.keys(e).forEach(function(n){t.setAttributeNS(null,n,e[n])}),t}}],[{key:"out",value:function(t,e,n){var r=document.createElementNS("http://www.w3.org/2000/svg","svg"),i=document.createElementNS("http://www.w3.org/2000/svg","g");return r.setAttributeNS(null,"viewBox","0 0 "+e+" "+n),r.appendChild(i),t.forEach(function(t){i.appendChild(t)}),r}}]),e}(),a=function(e){function n(){return t.classCallCheck(this,n),t.possibleConstructorReturn(this,Object.getPrototypeOf(n).apply(this,arguments))}return t.inherits(n,e),t.createClass(n,[{key:"render",value:function(){var t=this.attr(this.elm("polygon"),{"stroke-linejoin":"round","stroke-miterlimit":"1","stroke-width":"1",points:this.points.map(function(t){return t.x+" "+t.y}).join(" "),style:"fill:"+this.colour.toString()+"; stroke:"+this.colour.toString()+";"});return t}}]),n}(o),h=function(e){function r(e,n){t.classCallCheck(this,r);var i=t.possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this));return i.points=e,i.colour=n,i.face=function(t){return t>50?0:50>t&&t>25?1:25>t?2:void 0}(100*Math.random()),i.el=i.render(),i.centroid=i.calcCentroid(),i.normal=i.calcNormal(),i}return t.inherits(r,e),t.createClass(r,[{key:"calcCentroid",value:function(){var t=new n.Three([this.points.map(function(t){return t.x}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.y}).reduce(function(t,e){return t+e}),this.points.map(function(t){return t.z}).reduce(function(t,e){return t+e})]);return t.divideScalar(3)}},{key:"calcNormal",value:function(){return this.a.subtract(this.b).cross(this.a.subtract(this.c)).normalize()}},{key:"a",get:function(){return this.points[0]}},{key:"b",get:function(){return this.points[1]}},{key:"c",get:function(){return this.points[2]}}]),r}(a);return r});